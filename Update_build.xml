<project name="LucteriosUpdate" default="build" basedir=".">
	
	<property name="projet.sources.dir" value="${ant.project.name}/org"/>
	<property name="projet.bin.dir" value="${ant.project.name}"/>
	<property name="projet.doc.dir" value="${ant.project.name}/doc"/>
	<property name="projet.lib.dir" value="lib"/>

	<path id="projet.classpath">
		<fileset dir="${projet.lib.dir}">
			<include name="*.jar"/>
		</fileset>
		<pathelement location="${projet.bin.dir}" />
	</path>
 
	<target name="tests" >
		<junit fork="yes" printsummary="no" haltonfailure="no">
			<jvmarg value="-Djava.awt.headless=true"/>
			<batchtest fork="yes" todir="${projet.bin.dir}" >
				<fileset dir="${projet.bin.dir}">
					<include name="**/AllTests.class" />
				</fileset>
			</batchtest>
			<formatter type="xml" />
			<classpath>
				<fileset dir="${projet.lib.dir}">
					<include name="*.jar"/>
				</fileset>
				<pathelement location="${projet.bin.dir}/${ant.project.name}.jar" />
			</classpath>
		</junit>
	</target>
	
	<target name="build" depends="clear,compile,packaging" />
	
	<target name="clear">
		<delete dir="${projet.doc.dir}" /> 
		<delete file="${projet.bin.dir}/${ant.project.name}.jar" /> 
		<delete>
			<fileset dir="${projet.bin.dir}" includes="TEST*.xml" />
		</delete>
		<delete>
			<fileset dir="${projet.sources.dir}" includes="**/*.class" />
		</delete>
	</target>
	 
	 <target name="compile" description="Compilation des classes">
		<javac srcdir="${projet.sources.dir}"
			destdir="${projet.bin.dir}"
			encoding="utf-8"
			target="1.6"
			source="1.6"
			debug="off"
			optimize="on" 
			includeAntRuntime="false"
			deprecation="off">
			<classpath refid="projet.classpath"/>
		</javac>
	</target>
	
	<target name="packaging">
		<manifest file="${projet.bin.dir}/Manifest.txt">
			<attribute name="Created-By" value="Lucterios"/>
			<attribute name="Main-Class" value="org.lucterios.update.Main"/>
			<attribute name="Class-Path" value="" />
			<section name="LucteriosUpdate">
				<attribute name="Specification-Title" value="LucteriosUpdate"/>
				<attribute name="Specification-Version" value="${projet.version.max}.${projet.version.min}"/>
				<attribute name="Specification-Vendor" value="lucterios.org"/>
				<attribute name="Implementation-Title" value="LucteriosUpdate"/>
				<attribute name="Implementation-Version" value="${projet.version.max}.${projet.version.min}.${projet.version.release}.${projet.version.build} ${TODAY}"/> 
				<attribute name="Implementation-Vendor" value="lucterios.org"/>
			</section>
		</manifest>		
		<jar jarfile="${projet.bin.dir}/${ant.project.name}.jar" basedir="${projet.bin.dir}" manifest="${projet.bin.dir}/Manifest.txt" excludes='.svn' />
		<copy file="${projet.bin.dir}/${ant.project.name}.jar" todir="." overwrite="true"/>
	</target>
	
	<target name="javadoc">
		<delete dir="${projet.doc.dir}" /> 
		<mkdir dir="${projet.doc.dir}" /> 
		<javadoc sourcepath="${projet.sources.dir}" destdir="${projet.doc.dir}" >
			<fileset dir="${projet.sources.dir}" defaultexcludes="yes">
				<include name="**/*.java" />				
			</fileset>
		</javadoc>
	</target> 
		
</project>